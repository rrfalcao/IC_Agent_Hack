{"version":3,"sources":["../../src/types/network.ts","../../src/types/payment.ts","../../src/types/schemas.ts","../../src/types/responses.ts"],"names":["z"],"mappings":"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","file":"index.js","sourcesContent":["/**\n * Supported EVM networks for q402 protocol\n */\nexport const SupportedNetworks = {\n  BSC_MAINNET: \"bsc-mainnet\",\n  BSC_TESTNET: \"bsc-testnet\",\n} as const;\n\nexport type SupportedNetwork = (typeof SupportedNetworks)[keyof typeof SupportedNetworks];\n\n/**\n * Network configuration for different chains\n */\nexport interface NetworkConfig {\n  chainId: number;\n  name: string;\n  rpcUrl: string;\n  explorer: string;\n}\n\n/**\n * Network configurations\n */\nexport const NetworkConfigs: Record<SupportedNetwork, NetworkConfig> = {\n  [SupportedNetworks.BSC_MAINNET]: {\n    chainId: 56,\n    name: \"BNB Smart Chain Mainnet\",\n    rpcUrl: \"https://bsc-dataseed1.binance.org\",\n    explorer: \"https://bscscan.com\",\n  },\n  [SupportedNetworks.BSC_TESTNET]: {\n    chainId: 97,\n    name: \"BNB Smart Chain Testnet\",\n    rpcUrl: \"https://data-seed-prebsc-1-s1.binance.org:8545\",\n    explorer: \"https://testnet.bscscan.com\",\n  },\n};\n\n","import type { Address, Hex } from \"viem\";\nimport type { AuthorizationTuple } from \"./eip7702\";\nimport type { WitnessTypedData, BatchWitnessTypedData, PaymentItem } from \"./eip712\";\nimport type { SupportedNetwork } from \"./network\";\n\n// Re-export PaymentItem for external use\nexport type { PaymentItem } from \"./eip712\";\n\n/**\n * Payment scheme identifier\n */\nexport const PaymentScheme = {\n  EIP7702_DELEGATED: \"evm/eip7702-delegated-payment\",\n  EIP7702_DELEGATED_BATCH: \"evm/eip7702-delegated-batch\",\n} as const;\n\nexport type PaymentSchemeType = (typeof PaymentScheme)[keyof typeof PaymentScheme];\n\n/**\n * Payment details returned by resource server in 402 response\n */\nexport interface PaymentDetails {\n  /**\n   * Payment scheme identifier\n   */\n  scheme: PaymentSchemeType;\n\n  /**\n   * Network identifier\n   */\n  networkId: SupportedNetwork;\n\n  /**\n   * Token contract address\n   */\n  token: Address;\n\n  /**\n   * Payment amount in atomic units\n   */\n  amount: string;\n\n  /**\n   * Recipient address (resource server settlement wallet)\n   */\n  to: Address;\n\n  /**\n   * Implementation contract address (whitelisted delegation target)\n   */\n  implementationContract: Address;\n\n  /**\n   * EIP-712 witness typed data\n   */\n  witness: WitnessTypedData | BatchWitnessTypedData;\n\n  /**\n   * Authorization tuple template (without signature)\n   */\n  authorization: {\n    chainId: number;\n    address: Address;\n    nonce: number;\n  };\n}\n\n/**\n * Batch payment details\n */\nexport interface BatchPaymentDetails extends Omit<PaymentDetails, \"token\" | \"amount\" | \"witness\"> {\n  scheme: typeof PaymentScheme.EIP7702_DELEGATED_BATCH;\n  items: PaymentItem[];\n  witness: BatchWitnessTypedData;\n}\n\n/**\n * Signed payment payload for X-PAYMENT header\n */\nexport interface SignedPaymentPayload {\n  /**\n   * Witness signature (EIP-712)\n   */\n  witnessSignature: Hex;\n\n  /**\n   * Signed authorization tuple (EIP-7702)\n   */\n  authorization: AuthorizationTuple;\n\n  /**\n   * Payment details\n   */\n  paymentDetails: PaymentDetails | BatchPaymentDetails;\n}\n\n/**\n * 402 Payment Required response\n */\nexport interface PaymentRequiredResponse {\n  /**\n   * Protocol version\n   */\n  x402Version: number;\n\n  /**\n   * Accepted payment methods\n   */\n  accepts: PaymentDetails[];\n\n  /**\n   * Optional error message\n   */\n  error?: string;\n}\n\n/**\n * Payment execution response\n */\nexport interface PaymentExecutionResponse {\n  /**\n   * Transaction hash\n   */\n  txHash: Hex;\n\n  /**\n   * Block number\n   */\n  blockNumber?: bigint;\n\n  /**\n   * Transaction status\n   */\n  status: \"pending\" | \"confirmed\" | \"failed\";\n\n  /**\n   * Transfer events or receipts\n   */\n  transfers?: Array<{\n    token: Address;\n    from: Address;\n    to: Address;\n    amount: bigint;\n  }>;\n\n  /**\n   * Error message if failed\n   */\n  error?: string;\n}\n\n","import { z } from \"zod\";\nimport { SupportedNetworks, type SupportedNetwork } from \"./network\";\nimport { PaymentScheme } from \"./payment\";\n\n/**\n * Address validation schema (Ethereum address)\n */\nexport const AddressSchema = z.string().regex(/^0x[0-9a-fA-F]{40}$/);\n\n/**\n * Hex string validation schema\n */\nexport const HexSchema = z.string().regex(/^0x[0-9a-fA-F]+$/);\n\n/**\n * BigInt string schema\n */\nexport const BigIntStringSchema = z.string().regex(/^\\d+$/);\n\n/**\n * Network schema\n */\nexport const NetworkSchema = z.enum([\n  SupportedNetworks.BSC_MAINNET,\n  SupportedNetworks.BSC_TESTNET,\n] as [SupportedNetwork, ...SupportedNetwork[]]);\n\n/**\n * Payment scheme schema\n */\nexport const PaymentSchemeSchema = z.enum([\n  PaymentScheme.EIP7702_DELEGATED,\n  PaymentScheme.EIP7702_DELEGATED_BATCH,\n]);\n\n/**\n * EIP-712 domain schema\n */\nexport const Eip712DomainSchema = z.object({\n  name: z.string(),\n  version: z.string().optional(),\n  chainId: z.number(),\n  verifyingContract: AddressSchema,\n});\n\n/**\n * Witness message schema\n */\nexport const WitnessMessageSchema = z.object({\n  owner: AddressSchema,\n  token: AddressSchema,\n  amount: BigIntStringSchema,\n  to: AddressSchema,\n  deadline: BigIntStringSchema,\n  paymentId: HexSchema,\n  nonce: BigIntStringSchema,\n});\n\n/**\n * Payment item schema\n */\nexport const PaymentItemSchema = z.object({\n  token: AddressSchema,\n  amount: BigIntStringSchema,\n  to: AddressSchema,\n});\n\n/**\n * Batch witness message schema\n */\nexport const BatchWitnessMessageSchema = z.object({\n  owner: AddressSchema,\n  items: z.array(PaymentItemSchema),\n  deadline: BigIntStringSchema,\n  paymentId: HexSchema,\n  nonce: BigIntStringSchema,\n});\n\n/**\n * Authorization tuple schema\n */\nexport const AuthorizationTupleSchema = z.object({\n  chainId: z.number(),\n  address: AddressSchema,\n  nonce: z.number(),\n  yParity: z.number().min(0).max(1),\n  r: HexSchema,\n  s: HexSchema,\n});\n\n/**\n * Payment details schema\n */\nexport const PaymentDetailsSchema = z.object({\n  scheme: PaymentSchemeSchema,\n  networkId: NetworkSchema,\n  token: AddressSchema,\n  amount: BigIntStringSchema,\n  to: AddressSchema,\n  implementationContract: AddressSchema,\n  witness: z.record(z.any()), // Flexible for typed data\n  authorization: z.object({\n    chainId: z.number(),\n    address: AddressSchema,\n    nonce: z.number(),\n  }),\n});\n\n/**\n * Payment required response schema\n */\nexport const PaymentRequiredResponseSchema = z.object({\n  x402Version: z.number(),\n  accepts: z.array(PaymentDetailsSchema),\n  error: z.string().optional(),\n});\n\n/**\n * Signed payment payload schema\n */\nexport const SignedPaymentPayloadSchema = z.object({\n  witnessSignature: HexSchema,\n  authorization: AuthorizationTupleSchema,\n  paymentDetails: PaymentDetailsSchema,\n});\n\n","import type { Hex } from \"viem\";\n\n/**\n * Verification result\n */\nexport interface VerificationResult {\n  /**\n   * Whether the payment is valid\n   */\n  isValid: boolean;\n\n  /**\n   * Reason for invalidity\n   */\n  invalidReason?: string;\n\n  /**\n   * Recovered payer address\n   */\n  payer?: string;\n\n  /**\n   * Additional validation details\n   */\n  details?: {\n    witnessValid: boolean;\n    authorizationValid: boolean;\n    amountValid: boolean;\n    deadlineValid: boolean;\n    recipientValid: boolean;\n  };\n}\n\n/**\n * Settlement result\n */\nexport interface SettlementResult {\n  /**\n   * Whether settlement was successful\n   */\n  success: boolean;\n\n  /**\n   * Transaction hash if successful\n   */\n  txHash?: Hex;\n\n  /**\n   * Error message if failed\n   */\n  error?: string;\n\n  /**\n   * Block number\n   */\n  blockNumber?: bigint;\n}\n\n/**\n * Error reasons for payment validation\n */\nexport const ErrorReason = {\n  INSUFFICIENT_FUNDS: \"insufficient_funds\",\n  INVALID_SIGNATURE: \"invalid_signature\",\n  INVALID_AUTHORIZATION: \"invalid_authorization\",\n  INVALID_AMOUNT: \"invalid_amount\",\n  INVALID_RECIPIENT: \"invalid_recipient\",\n  PAYMENT_EXPIRED: \"payment_expired\",\n  NONCE_REUSED: \"nonce_reused\",\n  INVALID_IMPLEMENTATION: \"invalid_implementation\",\n  INVALID_NETWORK: \"invalid_network\",\n  INVALID_SCHEME: \"invalid_scheme\",\n  UNEXPECTED_ERROR: \"unexpected_error\",\n} as const;\n\nexport type ErrorReasonType = (typeof ErrorReason)[keyof typeof ErrorReason];\n\n"]}