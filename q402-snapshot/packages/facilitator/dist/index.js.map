{"version":3,"sources":["../src/config/env.ts","../src/config/networks.ts","../src/services/verification.ts","../src/api/routes/verify.ts","../src/services/settlement.ts","../src/api/routes/settle.ts","../src/api/routes/supported.ts","../src/api/server.ts","../src/index.ts"],"names":["config","path","privateKeyToAccount","createWalletClient","bsc","http","createPublicClient","SupportedNetworks","bscTestnet","ErrorReason","SignedPaymentPayloadSchema","PaymentScheme","ethers","NetworkConfigs","express"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAKAA,aAAA,CAAO,EAAE,MAAMC,qBAAA,CAAK,OAAA,CAAQ,QAAQ,GAAA,EAAI,EAAG,MAAM,CAAA,EAAG,CAAA;AA6C7C,SAAS,aAAA,GAA2B;AACzC,EAAA,MAAM,IAAA,GAAO,OAAA,CAAQ,GAAA,CAAI,IAAA,IAAQ,SAAA;AACjC,EAAA,MAAM,OAAO,QAAA,CAAS,OAAA,CAAQ,GAAA,CAAI,IAAA,IAAQ,QAAQ,EAAE,CAAA;AACpD,EAAA,MAAM,QAAA,GAAW,OAAA,CAAQ,GAAA,CAAI,SAAA,IAAa,MAAA;AAE1C,EAAA,MAAM,iBAAA,GAAoB,QAAQ,GAAA,CAAI,mBAAA;AACtC,EAAA,IAAI,CAAC,iBAAA,IAAqB,CAAC,iBAAA,CAAkB,UAAA,CAAW,IAAI,CAAA,EAAG;AAC7D,IAAA,MAAM,IAAI,MAAM,sDAAsD,CAAA;AAAA,EACxE;AAEA,EAAA,MAAM,gBAAA,GAAmB,QAAQ,GAAA,CAAI,mBAAA;AACrC,EAAA,MAAM,gBAAA,GAAmB,QAAQ,GAAA,CAAI,mBAAA;AAErC,EAAA,IAAI,CAAC,gBAAA,IAAoB,CAAC,gBAAA,EAAkB;AAC1C,IAAA,MAAM,IAAI,MAAM,yCAAyC,CAAA;AAAA,EAC3D;AAGA,EAAA,MAAM,YAAA,GAAe,OAAA,CAAQ,GAAA,CAAI,wBAAA,IAA4B,EAAA;AAC7D,EAAA,MAAM,0BAA0B,YAAA,CAC7B,KAAA,CAAM,GAAG,CAAA,CACT,GAAA,CAAI,CAAC,IAAA,KAAS,IAAA,CAAK,MAAiB,CAAA,CACpC,OAAO,CAAC,IAAA,KAAS,QAAQ,IAAA,CAAK,UAAA,CAAW,IAAI,CAAC,CAAA;AAEjD,EAAA,OAAO;AAAA,IACL,IAAA;AAAA,IACA,IAAA;AAAA,IACA,QAAA;AAAA,IACA,iBAAA;AAAA,IACA,gBAAA;AAAA,IACA,gBAAA;AAAA,IACA;AAAA,GACF;AACF;AChEO,SAAS,qBACdD,OAAAA,EACuC;AACvC,EAAA,MAAM,OAAA,GAAUE,4BAAA,CAAoBF,OAAAA,CAAO,iBAAiB,CAAA;AAC5D,EAAA,MAAM,OAAA,uBAAc,GAAA,EAAsC;AAG1D,EAAA,IAAIA,QAAO,gBAAA,EAAkB;AAC3B,IAAA,MAAM,eAAeG,uBAAA,CAAmB;AAAA,MACtC,OAAA;AAAA,MACA,KAAA,EAAOC,UAAA;AAAA,MACP,SAAA,EAAWC,SAAA,CAAKL,OAAAA,CAAO,gBAAgB;AAAA,KACxC,CAAA;AAED,IAAA,MAAM,eAAeM,uBAAA,CAAmB;AAAA,MACtC,KAAA,EAAOF,UAAA;AAAA,MACP,SAAA,EAAWC,SAAA,CAAKL,OAAAA,CAAO,gBAAgB;AAAA,KACxC,CAAA;AAED,IAAA,OAAA,CAAQ,IAAIO,sBAAA,CAAkB,WAAA,EAAa,EAAE,YAAA,EAAc,cAAc,CAAA;AAAA,EAC3E;AAGA,EAAA,IAAIP,QAAO,gBAAA,EAAkB;AAC3B,IAAA,MAAM,eAAeG,uBAAA,CAAmB;AAAA,MACtC,OAAA;AAAA,MACA,KAAA,EAAOK,iBAAA;AAAA,MACP,SAAA,EAAWH,SAAA,CAAKL,OAAAA,CAAO,gBAAgB;AAAA,KACxC,CAAA;AAED,IAAA,MAAM,eAAeM,uBAAA,CAAmB;AAAA,MACtC,KAAA,EAAOE,iBAAA;AAAA,MACP,SAAA,EAAWH,SAAA,CAAKL,OAAAA,CAAO,gBAAgB;AAAA,KACxC,CAAA;AAED,IAAA,OAAA,CAAQ,IAAIO,sBAAA,CAAkB,WAAA,EAAa,EAAE,YAAA,EAAc,cAAc,CAAA;AAAA,EAC3E;AAEA,EAAA,OAAO,OAAA;AACT;AAKO,SAAS,iBAAA,CACd,YACA,OAAA,EAC4B;AAC5B,EAAA,OAAO,UAAA,CAAW,IAAI,OAAO,CAAA;AAC/B;AC7DA,eAAsB,uBAAA,CACpB,SACAP,OAAAA,EAC6B;AAE7B,EAAA,IAAIA,OAAAA,CAAO,uBAAA,CAAwB,MAAA,GAAS,CAAA,EAAG;AAC7C,IAAA,MAAM,sBAAA,GAAyB,OAAA,CAAQ,cAAA,CAAe,sBAAA,CAAuB,WAAA,EAAY;AACzF,IAAA,MAAM,aAAA,GAAgBA,QAAO,uBAAA,CAAwB,IAAA;AAAA,MACnD,CAAC,IAAA,KAAS,IAAA,CAAK,WAAA,EAAY,KAAM;AAAA,KACnC;AAEA,IAAA,OAAA,CAAQ,IAAI,CAAA,4CAAA,CAAuC,CAAA;AACnD,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,aAAA,EAAgB,sBAAsB,CAAA,CAAE,CAAA;AACpD,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,cAAA,EAAiBA,OAAAA,CAAO,uBAAA,CAAwB,GAAA,CAAI,CAAA,CAAA,KAAK,CAAA,CAAE,WAAA,EAAa,CAAA,CAAE,IAAA,CAAK,IAAI,CAAC,CAAA,CAAE,CAAA;AAClG,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,mBAAA,EAAsB,aAAa,CAAA,CAAE,CAAA;AAEjD,IAAA,IAAI,CAAC,aAAA,EAAe;AAClB,MAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,+BAAA,EAA6B,sBAAsB,CAAA,oBAAA,CAAsB,CAAA;AACvF,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,eAAeS,gBAAA,CAAY;AAAA,OAC7B;AAAA,IACF;AAAA,EACF,CAAA,MAAO;AACL,IAAA,OAAA,CAAQ,IAAI,CAAA,yEAAA,CAAiE,CAAA;AAAA,EAC/E;AAGA,EAAA,OAAO,MAAM,mBAAmB,OAAO,CAAA;AACzC;AAKA,eAAe,mBAAmB,OAAA,EAA4D;AAC5F,EAAA,IAAI;AACF,IAAA,MAAM,EAAE,gBAAA,EAAkB,aAAA,EAAe,cAAA,EAAe,GAAI,OAAA;AAG5D,IAAA,IAAI,CAAC,gBAAA,IAAoB,CAAC,aAAA,IAAiB,CAAC,cAAA,EAAgB;AAC1D,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,eAAeA,gBAAA,CAAY;AAAA,OAC7B;AAAA,IACF;AAEA,IAAA,MAAM,UAAU,cAAA,CAAe,OAAA;AAC/B,IAAA,IAAI,CAAC,OAAA,EAAS,OAAA,IAAW,CAAC,SAAS,MAAA,EAAQ;AACzC,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,eAAeA,gBAAA,CAAY;AAAA,OAC7B;AAAA,IACF;AAGA,IAAA,MAAM,MAAM,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,GAAA,KAAQ,GAAI,CAAA;AACxC,IAAA,IAAI,OAAA,CAAQ,QAAQ,QAAA,IAAY,GAAA,GAAM,OAAO,OAAA,CAAQ,OAAA,CAAQ,QAAQ,CAAA,EAAG;AACtE,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,eAAeA,gBAAA,CAAY;AAAA,OAC7B;AAAA,IACF;AAGA,IAAA,MAAM,kBAAA,GAAqB,iBAAiB,gBAAgB,CAAA;AAC5D,IAAA,MAAM,wBAAA,GAA2B,qBAAqB,aAAa,CAAA;AAEnE,IAAA,IAAI,CAAC,kBAAA,EAAoB;AACvB,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,eAAeA,gBAAA,CAAY;AAAA,OAC7B;AAAA,IACF;AAEA,IAAA,IAAI,CAAC,wBAAA,EAA0B;AAC7B,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,eAAeA,gBAAA,CAAY;AAAA,OAC7B;AAAA,IACF;AAGA,IAAA,MAAM,eAAe,MAAM,qBAAA;AAAA,MACzB,gBAAA;AAAA,MACA,OAAA;AAAA,MACA,QAAQ,OAAA,CAAQ;AAAA,KAClB;AAEA,IAAA,IAAI,CAAC,YAAA,EAAc;AACjB,MAAA,OAAA,CAAQ,MAAM,8CAAyC,CAAA;AACvD,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,eAAeA,gBAAA,CAAY;AAAA,OAC7B;AAAA,IACF;AAEA,IAAA,OAAA,CAAQ,IAAI,gDAA2C,CAAA;AAGvD,IAAA,MAAM,qBAAqB,MAAM,0BAAA;AAAA,MAC/B,aAAA;AAAA,MACA,cAAA,CAAe,sBAAA;AAAA,MACf,QAAQ,OAAA,CAAQ;AAAA;AAAA,KAClB;AAEA,IAAA,IAAI,CAAC,kBAAA,EAAoB;AACvB,MAAA,OAAA,CAAQ,MAAM,mDAA8C,CAAA;AAC5D,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,eAAeA,gBAAA,CAAY;AAAA,OAC7B;AAAA,IACF;AAEA,IAAA,OAAA,CAAQ,IAAI,qDAAgD,CAAA;AAG5D,IAAA,MAAM,cAAc,QAAA,IAAY,cAAA,GAAiB,aAAA,CAAc,cAAA,CAAe,MAAM,CAAA,GAAI,IAAA;AACxF,IAAA,MAAM,cAAA,GAAiB,gBAAA,CAAiB,cAAA,CAAe,EAAE,CAAA;AAEzD,IAAA,IAAI,CAAC,WAAA,EAAa;AAChB,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,eAAeA,gBAAA,CAAY;AAAA,OAC7B;AAAA,IACF;AAEA,IAAA,IAAI,CAAC,cAAA,EAAgB;AACnB,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,eAAeA,gBAAA,CAAY;AAAA,OAC7B;AAAA,IACF;AAGA,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,IAAA;AAAA,MACT,OAAO,aAAA,CAAc,OAAA;AAAA,MACrB,OAAA,EAAS;AAAA,QACP,YAAA;AAAA,QACA,kBAAA;AAAA,QACA,WAAA;AAAA,QACA,aAAA,EAAe,IAAA;AAAA,QACf;AAAA;AACF,KACF;AAAA,EAEF,SAAS,KAAA,EAAO;AACd,IAAA,OAAA,CAAQ,KAAA,CAAM,+BAA+B,KAAK,CAAA;AAClD,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,eAAeA,gBAAA,CAAY;AAAA,KAC7B;AAAA,EACF;AACF;AAKA,SAAS,iBAAiB,SAAA,EAA4B;AACpD,EAAA,OACE,OAAO,cAAc,QAAA,IACrB,SAAA,CAAU,WAAW,IAAI,CAAA,IACzB,UAAU,MAAA,KAAW,GAAA;AAEzB;AAKA,SAAS,qBAAqB,aAAA,EAA6B;AACzD,EAAA,MAAM,EAAE,OAAA,EAAS,OAAA,EAAS,OAAO,OAAA,EAAS,CAAA,EAAG,GAAE,GAAI,aAAA;AAEnD,EAAA,OAAO,CAAC,EACN,OAAO,OAAA,KAAY,YAAY,OAAA,GAAU,CAAA,IACzC,OAAO,OAAA,KAAY,QAAA,IAAY,QAAQ,UAAA,CAAW,IAAI,KAAK,OAAA,CAAQ,MAAA,KAAW,MAC9E,OAAO,KAAA,KAAU,QAAA,IAAY,KAAA,IAAS,CAAA,IACtC,OAAO,YAAY,QAAA,KAAa,OAAA,KAAY,KAAK,OAAA,KAAY,CAAA,CAAA,IAC7D,OAAO,CAAA,KAAM,QAAA,IAAY,CAAA,CAAE,UAAA,CAAW,IAAI,CAAA,IAAK,EAAE,MAAA,KAAW,EAAA,IAC5D,OAAO,CAAA,KAAM,QAAA,IAAY,EAAE,UAAA,CAAW,IAAI,CAAA,IAAK,CAAA,CAAE,MAAA,KAAW,EAAA,CAAA;AAEhE;AAKA,SAAS,cAAc,MAAA,EAAyB;AAC9C,EAAA,IAAI;AACF,IAAA,MAAM,YAAA,GAAe,OAAO,MAAM,CAAA;AAClC,IAAA,OAAO,YAAA,GAAe,EAAA;AAAA,EACxB,CAAA,CAAA,MAAQ;AACN,IAAA,OAAO,KAAA;AAAA,EACT;AACF;AAKA,SAAS,iBAAiB,SAAA,EAA4B;AACpD,EAAA,OACE,OAAO,cAAc,QAAA,IACrB,SAAA,CAAU,WAAW,IAAI,CAAA,IACzB,UAAU,MAAA,KAAW,EAAA;AAEzB;AAKA,eAAe,qBAAA,CACb,SAAA,EACA,OAAA,EACA,cAAA,EACkB;AAClB,EAAA,IAAI;AACF,IAAA,MAAM,EAAE,eAAA,EAAgB,GAAI,MAAM,OAAO,MAAM,CAAA;AAE/C,IAAA,MAAM,EAAE,MAAA,EAAQ,KAAA,EAAO,OAAA,EAAQ,GAAI,OAAA;AAGnC,IAAA,MAAM,KAAA,GAAQ,MAAM,eAAA,CAAgB;AAAA,MAClC,OAAA,EAAS,cAAA;AAAA,MACT,MAAA,EAAQ;AAAA,QACN,MAAM,MAAA,CAAO,IAAA;AAAA,QACb,SAAS,MAAA,CAAO,OAAA;AAAA,QAChB,SAAS,MAAA,CAAO,OAAA;AAAA,QAChB,mBAAmB,MAAA,CAAO;AAAA,OAC5B;AAAA,MACA,KAAA;AAAA,MACA,WAAA,EAAa,OAAO,IAAA,CAAK,KAAK,EAAE,IAAA,CAAK,CAAA,GAAA,KAAO,GAAA,KAAQ,cAAc,CAAA,IAAK,uBAAA;AAAA,MACvE,OAAA;AAAA,MACA;AAAA,KACD,CAAA;AAED,IAAA,OAAO,KAAA;AAAA,EAET,SAAS,KAAA,EAAO;AACd,IAAA,OAAA,CAAQ,KAAA,CAAM,+BAA+B,KAAK,CAAA;AAClD,IAAA,OAAO,KAAA;AAAA,EACT;AACF;AAQA,eAAe,0BAAA,CACb,aAAA,EACA,gBAAA,EACA,cAAA,EACkB;AAClB,EAAA,IAAI;AACF,IAAA,MAAM,IAAA,GAAO,MAAM,OAAO,MAAM,CAAA;AAChC,IAAA,MAAM,EAAE,cAAA,EAAgB,SAAA,EAAW,OAAO,KAAA,EAAO,MAAA,EAAQ,YAAW,GAAI,IAAA;AAExE,IAAA,MAAM,EAAE,OAAA,EAAS,OAAA,EAAS,OAAO,OAAA,EAAS,CAAA,EAAG,GAAE,GAAI,aAAA;AAEnD,IAAA,OAAA,CAAQ,IAAI,CAAA,2CAAA,CAAsC,CAAA;AAClD,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,qBAAA,EAAwB,OAAO,CAAA,CAAE,CAAA;AAC7C,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,sBAAA,EAAyB,gBAAgB,CAAA,CAAE,CAAA;AACvD,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,4BAAA,EAA+B,cAAc,CAAA,CAAE,CAAA;AAC3D,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,aAAA,EAAgB,OAAO,CAAA,CAAE,CAAA;AACrC,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,cAAA,EAAiB,KAAK,CAAA,CAAE,CAAA;AAGpC,IAAA,IAAI,OAAA,CAAQ,WAAA,EAAY,KAAM,gBAAA,CAAiB,aAAY,EAAG;AAC5D,MAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,wCAAA,EAAsC,OAAO,CAAA,KAAA,EAAQ,gBAAgB,CAAA,CAAE,CAAA;AACrF,MAAA,OAAO,KAAA;AAAA,IACT;AAKA,IAAA,MAAM,KAAA,GAAQ,MAAA;AAGd,IAAA,MAAM,UAAU,KAAA,CAAM;AAAA,MACpB,MAAM,OAAO,CAAA;AAAA,MACb,QAAQ,WAAA,EAAY;AAAA,MACpB,MAAM,KAAK;AAAA,KACZ,CAAA;AAGD,IAAA,MAAM,WAAW,SAAA,CAAU,MAAA,CAAO,CAAC,KAAA,EAAc,OAAO,CAAC,CAAC,CAAA;AAC1D,IAAA,OAAA,CAAQ,IAAI,CAAA,uBAAA,EAA0B,QAAA,CAAS,MAAM,CAAA,EAAG,EAAE,CAAC,CAAA,GAAA,CAAK,CAAA;AAGhE,IAAA,MAAM,gBAAA,GAAmB,MAAM,cAAA,CAAe;AAAA,MAC5C,IAAA,EAAM,QAAA;AAAA,MACN,SAAA,EAAW,EAAE,CAAA,EAAa,CAAA,EAAa,OAAA;AAAQ,KAChD,CAAA;AAED,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,qBAAA,EAAwB,gBAAgB,CAAA,CAAE,CAAA;AAGtD,IAAA,IAAI,gBAAA,CAAiB,WAAA,EAAY,KAAM,cAAA,CAAe,aAAY,EAAG;AACnE,MAAA,OAAA,CAAQ,MAAM,CAAA,qCAAA,CAAkC,CAAA;AAChD,MAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,aAAA,EAAgB,cAAc,CAAA,CAAE,CAAA;AAC9C,MAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,QAAA,EAAW,gBAAgB,CAAA,CAAE,CAAA;AAC3C,MAAA,OAAO,KAAA;AAAA,IACT;AAEA,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,yDAAA,EAAuD,gBAAgB,CAAA,CAAA,CAAG,CAAA;AACtF,IAAA,OAAO,IAAA;AAAA,EAET,SAAS,KAAA,EAAO;AACd,IAAA,OAAA,CAAQ,KAAA,CAAM,qDAAgD,KAAK,CAAA;AACnE,IAAA,OAAO,KAAA;AAAA,EACT;AACF;;;ACnTA,eAAsB,YAAA,CACpB,GAAA,EACA,GAAA,EACAT,OAAAA,EACe;AACf,EAAA,IAAI;AAGF,IAAA,OAAA,CAAQ,GAAA,CAAI,qBAAA,EAAuB,GAAA,CAAI,IAAI,CAAA;AAE3C,IAAA,MAAM,WAAA,GAAcU,+BAAA,CAA2B,SAAA,CAAU,GAAA,CAAI,IAAI,CAAA;AAGjE,IAAA,IAAI,CAAC,YAAY,OAAA,EAAS;AACxB,MAAA,GAAA,CAAI,MAAA,CAAO,GAAG,CAAA,CAAE,IAAA,CAAK;AAAA,QACnB,KAAA,EAAO,yBAAA;AAAA,QACP,OAAA,EAAS,YAAY,KAAA,CAAM;AAAA,OAC5B,CAAA;AACD,MAAA;AAAA,IACF;AAEA,IAAA,MAAM,UAAgC,WAAA,CAAY,IAAA;AAGlD,IAAA,MAAM,MAAA,GAAS,MAAM,uBAAA,CAAwB,OAAA,EAASV,OAAM,CAAA;AAE5D,IAAA,OAAA,CAAQ,GAAA,CAAI,qBAAqB,MAAM,CAAA;AAEvC,IAAA,GAAA,CAAI,KAAK,MAAM,CAAA;AAAA,EACjB,SAAS,KAAA,EAAO;AACd,IAAA,OAAA,CAAQ,KAAA,CAAM,uBAAuB,KAAK,CAAA;AAC1C,IAAA,GAAA,CAAI,MAAA,CAAO,GAAG,CAAA,CAAE,IAAA,CAAK;AAAA,MACnB,KAAA,EAAO,uBAAA;AAAA,MACP,OAAA,EAAS,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU;AAAA,KACnD,CAAA;AAAA,EACH;AACF;ACpCA,eAAsB,4BACpB,OAAA,EAC2B;AAC3B,EAAA,IAAI;AACF,IAAA,MAAM,EAAE,gBAAA,EAAkB,aAAA,EAAe,cAAA,EAAe,GAAI,OAAA;AAG5D,IAAA,IAAI,cAAA,CAAe,MAAA,KAAWW,kBAAA,CAAc,iBAAA,EAAmB;AAC7D,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAA,EAAO;AAAA,OACT;AAAA,IACF;AAEA,IAAA,MAAM,UAAU,cAAA,CAAe,OAAA;AAE/B,IAAA,IAAI,CAAC,SAAS,OAAA,EAAS;AACrB,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAA,EAAO;AAAA,OACT;AAAA,IACF;AAEA,IAAA,MAAM,UAAU,OAAA,CAAQ,OAAA;AAIxB,IAAA,MAAM,SAAA,GAAa,IAAA,IAAQ,OAAA,IAAW,OAAA,CAAQ,EAAA,GAC1C,OAAA,CAAQ,EAAA,GACP,WAAA,IAAe,OAAA,IAAY,OAAA,CAAmC,SAAA,GAC9D,OAAA,CAAkC,YACnC,cAAA,CAAe,EAAA;AAEnB,IAAA,IAAI,CAAC,SAAA,EAAW;AACd,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAA,EAAO;AAAA,OACT;AAAA,IACF;AAGA,IAAA,MAAM,MAAA,GAAS,OAAA,CAAQ,GAAA,CAAI,mBAAA,IAAuB,QAAQ,GAAA,CAAI,OAAA;AAC9D,IAAA,MAAM,iBAAA,GAAoB,OAAA,CAAQ,GAAA,CAAI,mBAAA,IAAuB,QAAQ,GAAA,CAAI,uBAAA;AAEzE,IAAA,IAAI,CAAC,MAAA,IAAU,CAAC,iBAAA,EAAmB;AACjC,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAA,EAAO;AAAA,OACT;AAAA,IACF;AAGA,IAAA,MAAM,QAAA,GAAW,IAAIC,aAAA,CAAO,eAAA,CAAgB,MAAM,CAAA;AAClD,IAAA,MAAM,iBAAA,GAAoB,IAAIA,aAAA,CAAO,MAAA,CAAO,mBAAmB,QAAQ,CAAA;AAEvE,IAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,gCAAA,EAA4B,iBAAA,CAAkB,OAAO,CAAA,CAAE,CAAA;AAGrE,IAAA,MAAM,sBAAA,GAAyB;AAAA,MAC7B;AAAA,KACF;AAGA,IAAA,MAAM,MAAA,GAAS,OAAO,OAAA,CAAQ,MAAA,KAAW,QAAA,GAAW,OAAA,CAAQ,MAAA,CAAO,QAAA,EAAS,GAAI,MAAA,CAAO,OAAA,CAAQ,MAAM,CAAA;AACrG,IAAA,MAAM,KAAA,GAAQ,OAAO,OAAA,CAAQ,KAAA,KAAU,QAAA,GAAW,OAAA,CAAQ,KAAA,CAAM,QAAA,EAAS,GAAI,MAAA,CAAO,OAAA,CAAQ,KAAK,CAAA;AACjG,IAAA,MAAM,QAAA,GAAW,OAAO,OAAA,CAAQ,QAAA,KAAa,QAAA,GAAW,OAAA,CAAQ,QAAA,CAAS,QAAA,EAAS,GAAI,MAAA,CAAO,OAAA,CAAQ,QAAQ,CAAA;AAE7G,IAAA,MAAM,iBAAA,GAAoB,IAAIA,aAAA,CAAO,SAAA,CAAU,sBAAsB,CAAA;AACrE,IAAA,MAAM,QAAA,GAAW,iBAAA,CAAkB,kBAAA,CAAmB,iBAAA,EAAmB;AAAA,MACvE,OAAA,CAAQ,KAAA;AAAA;AAAA,MACR,iBAAA,CAAkB,OAAA;AAAA;AAAA,MAClB,OAAA,CAAQ,KAAA;AAAA;AAAA,MACR,SAAA;AAAA;AAAA,MACA,MAAA;AAAA;AAAA,MACA,KAAA;AAAA;AAAA,MACA,QAAA;AAAA;AAAA,MACA;AAAA;AAAA,KACD,CAAA;AAED,IAAA,OAAA,CAAQ,MAAM,CAAA,8BAAA,CAAyB,CAAA;AACvC,IAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,UAAA,EAAa,OAAA,CAAQ,KAAK,CAAA,CAAE,CAAA;AAC1C,IAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,gBAAA,EAAmB,iBAAA,CAAkB,OAAO,CAAA,CAAE,CAAA;AAC5D,IAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,UAAA,EAAa,OAAA,CAAQ,KAAK,CAAA,CAAE,CAAA;AAC1C,IAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,cAAA,EAAiB,SAAS,CAAA,CAAE,CAAA;AAC1C,IAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,WAAA,EAAc,MAAM,CAAA,CAAE,CAAA;AACpC,IAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,UAAA,EAAa,KAAK,CAAA,CAAE,CAAA;AAClC,IAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,aAAA,EAAgB,QAAQ,CAAA,CAAE,CAAA;AAGxC,IAAA,MAAM,gBAAA,GAAmB,MAAM,iBAAA,CAAkB,QAAA,EAAS;AAC1D,IAAA,MAAM,OAAA,GAAU,MAAM,QAAA,CAAS,UAAA,EAAW;AAI1C,IAAA,MAAM,kBAAA,GAAqB;AAAA,MACzB,OAAA,EAAS,MAAA,CAAO,aAAA,CAAc,OAAO,CAAA;AAAA,MACrC,SAAS,aAAA,CAAc,OAAA;AAAA,MACvB,KAAA,EAAO,MAAA,CAAO,aAAA,CAAc,KAAK,CAAA;AAAA,MACjC,SAAA,EAAW;AAAA,QACT,GAAG,aAAA,CAAc,CAAA;AAAA,QACjB,GAAG,aAAA,CAAc,CAAA;AAAA,QACjB,OAAA,EAAS,MAAA,CAAO,aAAA,CAAc,OAAO;AAAA;AACvC,KACF;AAGA,IAAA,MAAM,EAAA,GAAK;AAAA,MACT,IAAA,EAAM,CAAA;AAAA;AAAA,MACN,IAAI,OAAA,CAAQ,KAAA;AAAA;AAAA,MACZ,IAAA,EAAM,QAAA;AAAA,MACN,iBAAA,EAAmB,CAAC,kBAAkB,CAAA;AAAA,MACtC,OAAA,EAAS,MAAA,CAAO,aAAA,CAAc,OAAO,CAAA;AAAA,MACrC,KAAA,EAAO,gBAAA;AAAA,MACP,QAAA,EAAU,OAAA;AAAA,MACV,cAAc,OAAA,CAAQ,YAAA,IAAgBA,aAAA,CAAO,UAAA,CAAW,KAAK,MAAM,CAAA;AAAA,MACnE,sBAAsB,OAAA,CAAQ,oBAAA,IAAwBA,aAAA,CAAO,UAAA,CAAW,OAAO,MAAM;AAAA,KACvF;AAEA,IAAA,OAAA,CAAQ,MAAM,CAAA,yCAAA,CAAoC,CAAA;AAClD,IAAA,OAAA,CAAQ,MAAM,CAAA,wBAAA,CAA0B,CAAA;AACxC,IAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,SAAA,EAAY,iBAAA,CAAkB,OAAO,CAAA,cAAA,CAAgB,CAAA;AACnE,IAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,OAAA,EAAU,OAAA,CAAQ,KAAK,CAAA,WAAA,CAAa,CAAA;AAGlD,IAAA,MAAM,UAAA,GAAa,MAAM,iBAAA,CAAkB,eAAA,CAAgB,EAAE,CAAA;AAG7D,IAAA,MAAM,OAAA,GAAU,MAAM,UAAA,CAAW,IAAA,EAAK;AAGtC,IAAA,IAAI,CAAC,OAAA,EAAS;AACZ,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAA,EAAO,mCAAA;AAAA,QACP,QAAQ,UAAA,CAAW;AAAA,OACrB;AAAA,IACF;AAEA,IAAA,IAAI,OAAA,CAAQ,WAAW,CAAA,EAAG;AACxB,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,IAAA;AAAA,QACT,QAAQ,UAAA,CAAW,IAAA;AAAA,QACnB,WAAA,EAAa,MAAA,CAAO,OAAA,CAAQ,WAAW;AAAA,OACzC;AAAA,IACF,CAAA,MAAO;AACL,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAA,EAAO,+BAAA;AAAA,QACP,QAAQ,UAAA,CAAW;AAAA,OACrB;AAAA,IACF;AAAA,EAEF,SAAS,KAAA,EAAO;AACd,IAAA,OAAA,CAAQ,KAAA,CAAM,4BAAuB,KAAK,CAAA;AAC1C,IAAA,MAAM,eAAe,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AAG1E,IAAA,IAAI,YAAA,CAAa,QAAA,CAAS,oBAAoB,CAAA,EAAG;AAC/C,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAA,EAAO;AAAA,OACT;AAAA,IACF,CAAA,MAAA,IAAW,YAAA,CAAa,QAAA,CAAS,OAAO,CAAA,EAAG;AACzC,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAA,EAAO;AAAA,OACT;AAAA,IACF,CAAA,MAAA,IAAW,YAAA,CAAa,QAAA,CAAS,oBAAoB,CAAA,EAAG;AACtD,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAA,EAAO;AAAA,OACT;AAAA,IACF;AAEA,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAA,EAAO;AAAA,KACT;AAAA,EACF;AACF;;;ACnLA,eAAsB,YAAA,CACpB,GAAA,EACA,GAAA,EACA,UAAA,EACe;AACf,EAAA,IAAI;AAEF,IAAA,MAAM,WAAA,GAAcF,+BAAAA,CAA2B,SAAA,CAAU,GAAA,CAAI,IAAI,CAAA;AAEjE,IAAA,IAAI,CAAC,YAAY,OAAA,EAAS;AACxB,MAAA,GAAA,CAAI,MAAA,CAAO,GAAG,CAAA,CAAE,IAAA,CAAK;AAAA,QACnB,KAAA,EAAO,yBAAA;AAAA,QACP,OAAA,EAAS,YAAY,KAAA,CAAM;AAAA,OAC5B,CAAA;AACD,MAAA;AAAA,IACF;AAGA,IAAA,MAAM,SAAS,WAAA,CAAY,IAAA;AAC3B,IAAA,MAAM,OAAA,GAAgC;AAAA,MACpC,kBAAkB,MAAA,CAAO,gBAAA;AAAA,MACzB,aAAA,EAAe;AAAA,QACb,OAAA,EAAS,MAAA,CAAO,MAAA,CAAO,aAAA,CAAc,OAAO,CAAA;AAAA,QAC5C,OAAA,EAAS,OAAO,aAAA,CAAc,OAAA;AAAA,QAC9B,KAAA,EAAO,MAAA,CAAO,MAAA,CAAO,aAAA,CAAc,KAAK,CAAA;AAAA,QACxC,OAAA,EAAS,OAAO,aAAA,CAAc,OAAA;AAAA,QAC9B,CAAA,EAAG,OAAO,aAAA,CAAc,CAAA;AAAA,QACxB,CAAA,EAAG,OAAO,aAAA,CAAc;AAAA,OAC1B;AAAA,MACA,gBAAgB,MAAA,CAAO;AAAA,KACzB;AAGA,IAAA,MAAM,OAAA,GAAU,iBAAA,CAAkB,UAAA,EAAY,OAAA,CAAQ,eAAe,SAAS,CAAA;AAE9E,IAAA,IAAI,CAAC,OAAA,EAAS;AACZ,MAAA,GAAA,CAAI,MAAA,CAAO,GAAG,CAAA,CAAE,IAAA,CAAK;AAAA,QACnB,KAAA,EAAO,qBAAA;AAAA,QACP,OAAA,EAAS,QAAQ,cAAA,CAAe;AAAA,OACjC,CAAA;AACD,MAAA;AAAA,IACF;AAGA,IAAA,MAAM,MAAA,GAAS,MAAM,2BAAA,CAA4B,OAAO,CAAA;AAExD,IAAA,IAAI,OAAO,OAAA,EAAS;AAClB,MAAA,GAAA,CAAI,IAAA,CAAK;AAAA,QACP,OAAA,EAAS,IAAA;AAAA,QACT,QAAQ,MAAA,CAAO,MAAA;AAAA,QACf,WAAA,EAAa,MAAA,CAAO,WAAA,EAAa,QAAA;AAAS,OAC3C,CAAA;AAAA,IACH,CAAA,MAAO;AACL,MAAA,GAAA,CAAI,MAAA,CAAO,GAAG,CAAA,CAAE,IAAA,CAAK;AAAA,QACnB,OAAA,EAAS,KAAA;AAAA,QACT,OAAO,MAAA,CAAO;AAAA,OACf,CAAA;AAAA,IACH;AAAA,EACF,SAAS,KAAA,EAAO;AACd,IAAA,OAAA,CAAQ,KAAA,CAAM,qBAAqB,KAAK,CAAA;AACxC,IAAA,GAAA,CAAI,MAAA,CAAO,GAAG,CAAA,CAAE,IAAA,CAAK;AAAA,MACnB,KAAA,EAAO,uBAAA;AAAA,MACP,OAAA,EAAS,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU;AAAA,KACnD,CAAA;AAAA,EACH;AACF;AClEA,eAAsB,eAAA,CACpB,GAAA,EACA,GAAA,EACA,UAAA,EACe;AACf,EAAA,IAAI;AACF,IAAA,MAAM,iBAAA,GAAoB,MAAM,IAAA,CAAK,UAAA,CAAW,MAAM,CAAA,CAAE,GAAA,CAAI,CAAC,OAAA,KAAY;AACvE,MAAA,MAAMV,OAAAA,GAASa,oBAAe,OAAO,CAAA;AACrC,MAAA,OAAO;AAAA,QACL,SAAA,EAAW,OAAA;AAAA,QACX,SAASb,OAAAA,CAAO,OAAA;AAAA,QAChB,MAAMA,OAAAA,CAAO,IAAA;AAAA,QACb,UAAUA,OAAAA,CAAO;AAAA,OACnB;AAAA,IACF,CAAC,CAAA;AAED,IAAA,GAAA,CAAI,IAAA,CAAK;AAAA,MACP,OAAA,EAAS,CAAA;AAAA,MACT,QAAA,EAAU;AAAA,KACX,CAAA;AAAA,EACH,SAAS,KAAA,EAAO;AACd,IAAA,OAAA,CAAQ,KAAA,CAAM,6BAA6B,KAAK,CAAA;AAChD,IAAA,GAAA,CAAI,MAAA,CAAO,GAAG,CAAA,CAAE,IAAA,CAAK;AAAA,MACnB,KAAA,EAAO;AAAA,KACR,CAAA;AAAA,EACH;AACF;;;ACvBO,SAAS,YAAA,CACdA,SACA,UAAA,EACS;AACT,EAAA,MAAM,MAAMc,wBAAA,EAAQ;AAGpB,EAAA,GAAA,CAAI,GAAA,CAAIA,wBAAA,CAAQ,IAAA,EAAM,CAAA;AAGtB,EAAA,GAAA,CAAI,GAAA,CAAI,CAAC,GAAA,EAAK,GAAA,EAAK,IAAA,KAAS;AAC1B,IAAA,GAAA,CAAI,MAAA,CAAO,+BAA+B,GAAG,CAAA;AAC7C,IAAA,GAAA,CAAI,MAAA,CAAO,gCAAgC,oBAAoB,CAAA;AAC/D,IAAA,GAAA,CAAI,MAAA,CAAO,gCAAgC,6BAA6B,CAAA;AAExE,IAAA,IAAI,GAAA,CAAI,WAAW,SAAA,EAAW;AAC5B,MAAA,GAAA,CAAI,WAAW,GAAG,CAAA;AAClB,MAAA;AAAA,IACF;AAEA,IAAA,IAAA,EAAK;AAAA,EACP,CAAC,CAAA;AAGD,EAAA,GAAA,CAAI,GAAA,CAAI,GAAA,EAAK,CAAC,IAAA,EAAM,GAAA,KAAQ;AAC1B,IAAA,GAAA,CAAI,IAAA,CAAK;AAAA,MACP,IAAA,EAAM,sBAAA;AAAA,MACN,OAAA,EAAS,OAAA;AAAA,MACT,SAAA,EAAW;AAAA,QACT,MAAA,EAAQ,cAAA;AAAA,QACR,MAAA,EAAQ,cAAA;AAAA,QACR,SAAA,EAAW;AAAA;AACb,KACD,CAAA;AAAA,EACH,CAAC,CAAA;AAED,EAAA,GAAA,CAAI,IAAA,CAAK,WAAW,CAAC,GAAA,EAAK,QAAQ,YAAA,CAAa,GAAA,EAAK,GAAA,EAAKd,OAAM,CAAC,CAAA;AAEhE,EAAA,GAAA,CAAI,IAAA,CAAK,WAAW,CAAC,GAAA,EAAK,QAAQ,YAAA,CAAa,GAAA,EAAK,GAAA,EAAK,UAAU,CAAC,CAAA;AAEpE,EAAA,GAAA,CAAI,GAAA,CAAI,cAAc,CAAC,GAAA,EAAK,QAAQ,eAAA,CAAgB,GAAA,EAAK,GAAA,EAAK,UAAU,CAAC,CAAA;AAGzE,EAAA,GAAA,CAAI,GAAA,CAAI,SAAA,EAAW,CAAC,IAAA,EAAM,GAAA,KAAQ;AAEhC,IAAA,IAAI,kBAAA;AACJ,IAAA,IAAI;AAEF,MAAA,MAAM,cAAc,KAAA,CAAM,IAAA,CAAK,WAAW,MAAA,EAAQ,EAAE,CAAC,CAAA;AACrD,MAAA,kBAAA,GAAqB,WAAA,EAAa,cAAc,OAAA,EAAS,OAAA;AAAA,IAC3D,SAAS,KAAA,EAAO;AACd,MAAA,OAAA,CAAQ,IAAA,CAAK,4CAA4C,KAAK,CAAA;AAAA,IAChE;AAEA,IAAA,GAAA,CAAI,IAAA,CAAK;AAAA,MACP,MAAA,EAAQ,IAAA;AAAA,MACR,WAAA,EAAa;AAAA,KACd,CAAA;AAAA,EACH,CAAC,CAAA;AAGD,EAAA,GAAA,CAAI,GAAA,CAAI,CAAC,GAAA,EAAY,IAAA,EAAuB,KAAuB,KAAA,KAAgC;AACjG,IAAA,OAAA,CAAQ,KAAA,CAAM,iBAAiB,GAAG,CAAA;AAClC,IAAA,GAAA,CAAI,MAAA,CAAO,GAAG,CAAA,CAAE,IAAA,CAAK;AAAA,MACnB,KAAA,EAAO,uBAAA;AAAA,MACP,SAAS,GAAA,CAAI;AAAA,KACd,CAAA;AAAA,EACH,CAAC,CAAA;AAED,EAAA,OAAO,GAAA;AACT;;;ACvEA,eAAe,IAAA,GAAO;AACpB,EAAA,OAAA,CAAQ,IAAI,kCAAkC,CAAA;AAG9C,EAAA,MAAMA,UAAS,aAAA,EAAc;AAC7B,EAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,MAAA,EAASA,OAAAA,CAAO,IAAI,CAAA,CAAE,CAAA;AAClC,EAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,MAAA,EAASA,OAAAA,CAAO,IAAI,CAAA,CAAE,CAAA;AAClC,EAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,WAAA,EAAcA,OAAAA,CAAO,QAAQ,CAAA,CAAE,CAAA;AAG3C,EAAA,MAAM,UAAA,GAAa,qBAAqBA,OAAM,CAAA;AAC9C,EAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,WAAA,EAAc,UAAA,CAAW,IAAI,CAAA,WAAA,CAAa,CAAA;AAGtD,EAAA,MAAM,GAAA,GAAM,YAAA,CAAaA,OAAAA,EAAQ,UAAU,CAAA;AAE3C,EAAA,GAAA,CAAI,MAAA,CAAOA,OAAAA,CAAO,IAAA,EAAMA,OAAAA,CAAO,MAAM,MAAM;AACzC,IAAA,OAAA,CAAQ,IAAI,CAAA,gCAAA,EAAmCA,OAAAA,CAAO,IAAI,CAAA,CAAA,EAAIA,OAAAA,CAAO,IAAI,CAAA,CAAE,CAAA;AAC3E,IAAA,OAAA,CAAQ,IAAI,CAAA,0BAAA,CAA4B,CAAA;AAAA,EAC1C,CAAC,CAAA;AACH;AAGA,IAAI,SAAA,CAAQ,SAAS,MAAA,EAAQ;AAC3B,EAAA,IAAA,EAAK,CAAE,KAAA,CAAM,CAAC,KAAA,KAAU;AACtB,IAAA,OAAA,CAAQ,KAAA,CAAM,gBAAgB,KAAK,CAAA;AACnC,IAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,EAChB,CAAC,CAAA;AACH","file":"index.js","sourcesContent":["import { config } from \"dotenv\";\nimport type { Address, Hex } from \"viem\";\nimport path from \"path\";\n\n// Load environment variables from root directory\nconfig({ path: path.resolve(process.cwd(), \".env\") });\n\n/**\n * Environment configuration\n */\nexport interface EnvConfig {\n  /**\n   * Server host\n   */\n  host: string;\n\n  /**\n   * Server port\n   */\n  port: number;\n\n  /**\n   * Log level\n   */\n  logLevel: string;\n\n  /**\n   * Sponsor private key (for signing transactions)\n   */\n  sponsorPrivateKey: Hex;\n\n  /**\n   * BSC mainnet RPC URL\n   */\n  rpcUrlBscMainnet?: string;\n\n  /**\n   * BSC testnet RPC URL\n   */\n  rpcUrlBscTestnet?: string;\n\n  /**\n   * Implementation contract whitelist\n   */\n  implementationWhitelist: Address[];\n}\n\n/**\n * Load and validate environment configuration\n */\nexport function loadEnvConfig(): EnvConfig {\n  const host = process.env.HOST || \"0.0.0.0\";\n  const port = parseInt(process.env.PORT || \"8080\", 10);\n  const logLevel = process.env.LOG_LEVEL || \"info\";\n\n  const sponsorPrivateKey = process.env.SPONSOR_PRIVATE_KEY as Hex;\n  if (!sponsorPrivateKey || !sponsorPrivateKey.startsWith(\"0x\")) {\n    throw new Error(\"SPONSOR_PRIVATE_KEY environment variable is required\");\n  }\n\n  const rpcUrlBscMainnet = process.env.RPC_URL_BSC_MAINNET;\n  const rpcUrlBscTestnet = process.env.RPC_URL_BSC_TESTNET;\n\n  if (!rpcUrlBscMainnet && !rpcUrlBscTestnet) {\n    throw new Error(\"At least one RPC URL must be configured\");\n  }\n\n  // Parse whitelist\n  const whitelistStr = process.env.IMPLEMENTATION_WHITELIST || \"\";\n  const implementationWhitelist = whitelistStr\n    .split(\",\")\n    .map((addr) => addr.trim() as Address)\n    .filter((addr) => addr && addr.startsWith(\"0x\"));\n\n  return {\n    host,\n    port,\n    logLevel,\n    sponsorPrivateKey,\n    rpcUrlBscMainnet,\n    rpcUrlBscTestnet,\n    implementationWhitelist,\n  };\n}\n\n","import { createWalletClient, createPublicClient, http } from \"viem\";\nimport { privateKeyToAccount } from \"viem/accounts\";\nimport { bsc, bscTestnet } from \"viem/chains\";\nimport type { WalletClient, PublicClient } from \"viem\";\nimport type { SupportedNetwork } from \"@x402-bnb/core\";\nimport { SupportedNetworks } from \"@x402-bnb/core\";\nimport type { EnvConfig } from \"./env\";\n\n/**\n * Network clients\n */\nexport interface NetworkClients {\n  walletClient: WalletClient;\n  publicClient: PublicClient;\n}\n\n/**\n * Create network clients for all configured networks\n */\nexport function createNetworkClients(\n  config: EnvConfig,\n): Map<SupportedNetwork, NetworkClients> {\n  const account = privateKeyToAccount(config.sponsorPrivateKey);\n  const clients = new Map<SupportedNetwork, NetworkClients>();\n\n  // BSC Mainnet\n  if (config.rpcUrlBscMainnet) {\n    const walletClient = createWalletClient({\n      account,\n      chain: bsc,\n      transport: http(config.rpcUrlBscMainnet),\n    });\n\n    const publicClient = createPublicClient({\n      chain: bsc,\n      transport: http(config.rpcUrlBscMainnet),\n    });\n\n    clients.set(SupportedNetworks.BSC_MAINNET, { walletClient, publicClient });\n  }\n\n  // BSC Testnet\n  if (config.rpcUrlBscTestnet) {\n    const walletClient = createWalletClient({\n      account,\n      chain: bscTestnet,\n      transport: http(config.rpcUrlBscTestnet),\n    });\n\n    const publicClient = createPublicClient({\n      chain: bscTestnet,\n      transport: http(config.rpcUrlBscTestnet),\n    });\n\n    clients.set(SupportedNetworks.BSC_TESTNET, { walletClient, publicClient });\n  }\n\n  return clients;\n}\n\n/**\n * Get clients for a specific network\n */\nexport function getNetworkClients(\n  clientsMap: Map<SupportedNetwork, NetworkClients>,\n  network: SupportedNetwork,\n): NetworkClients | undefined {\n  return clientsMap.get(network);\n}\n\n","import type { SignedPaymentPayload, VerificationResult } from \"@x402-bnb/core\";\nimport type { EnvConfig } from \"../config/env\";\nimport { ErrorReason } from \"@x402-bnb/core\";\n\n/**\n * Verify a payment with additional checks\n */\nexport async function verifyPaymentWithChecks(\n  payload: SignedPaymentPayload,\n  config: EnvConfig,\n): Promise<VerificationResult> {\n  // Check implementation contract is whitelisted\n  if (config.implementationWhitelist.length > 0) {\n    const implementationContract = payload.paymentDetails.implementationContract.toLowerCase();\n    const isWhitelisted = config.implementationWhitelist.some(\n      (addr) => addr.toLowerCase() === implementationContract,\n    );\n\n    console.log(`üîç Checking implementation whitelist:`);\n    console.log(`   Contract: ${implementationContract}`);\n    console.log(`   Whitelist: ${config.implementationWhitelist.map(a => a.toLowerCase()).join(\", \")}`);\n    console.log(`   Is whitelisted: ${isWhitelisted}`);\n\n    if (!isWhitelisted) {\n      console.error(`‚ùå Implementation contract ${implementationContract} is not in whitelist`);\n      return {\n        isValid: false,\n        invalidReason: ErrorReason.INVALID_IMPLEMENTATION,\n      };\n    }\n  } else {\n    console.log(`‚ÑπÔ∏è  Implementation whitelist is empty, skipping whitelist check`);\n  }\n\n  // Perform standard verification using local function\n  return await verifyPaymentLocal(payload);\n}\n\n/**\n * Local implementation of payment verification with EIP-712 signature verification\n */\nasync function verifyPaymentLocal(payload: SignedPaymentPayload): Promise<VerificationResult> {\n  try {\n    const { witnessSignature, authorization, paymentDetails } = payload;\n    \n    // 1. Basic payload validation\n    if (!witnessSignature || !authorization || !paymentDetails) {\n      return {\n        isValid: false,\n        invalidReason: ErrorReason.INVALID_SIGNATURE,\n      };\n    }\n\n    const witness = paymentDetails.witness as any;\n    if (!witness?.message || !witness?.domain) {\n      return {\n        isValid: false,\n        invalidReason: ErrorReason.INVALID_SIGNATURE,\n      };\n    }\n\n    // 2. Check deadline (from witness message)\n    const now = Math.floor(Date.now() / 1000);\n    if (witness.message.deadline && now > Number(witness.message.deadline)) {\n      return {\n        isValid: false,\n        invalidReason: ErrorReason.PAYMENT_EXPIRED,\n      };\n    }\n\n    // 3. Verify signature formats\n    const witnessFormatValid = isValidSignature(witnessSignature);\n    const authorizationFormatValid = isValidAuthorization(authorization);\n\n    if (!witnessFormatValid) {\n      return {\n        isValid: false,\n        invalidReason: ErrorReason.INVALID_SIGNATURE,\n      };\n    }\n\n    if (!authorizationFormatValid) {\n      return {\n        isValid: false,\n        invalidReason: ErrorReason.INVALID_AUTHORIZATION,\n      };\n    }\n\n    // 4. Verify EIP-712 witness signature (actual cryptographic verification)\n    const witnessValid = await verifyEIP712Signature(\n      witnessSignature,\n      witness,\n      witness.message.owner\n    );\n\n    if (!witnessValid) {\n      console.error(\"‚ùå EIP-712 signature verification failed\");\n      return {\n        isValid: false,\n        invalidReason: ErrorReason.INVALID_SIGNATURE,\n      };\n    }\n\n    console.log(\"‚úÖ EIP-712 signature verified successfully\");\n\n    // 5. Verify EIP-7702 authorization signature\n    const authorizationValid = await verifyEIP7702Authorization(\n      authorization,\n      paymentDetails.implementationContract,\n      witness.message.owner  // Pass the expected signer (owner from witness)\n    );\n\n    if (!authorizationValid) {\n      console.error(\"‚ùå EIP-7702 authorization verification failed\");\n      return {\n        isValid: false,\n        invalidReason: ErrorReason.INVALID_AUTHORIZATION,\n      };\n    }\n\n    console.log(\"‚úÖ EIP-7702 authorization verified successfully\");\n\n    // 6. Verify amounts and recipients\n    const amountValid = 'amount' in paymentDetails ? isValidAmount(paymentDetails.amount) : true;\n    const recipientValid = isValidRecipient(paymentDetails.to);\n\n    if (!amountValid) {\n      return {\n        isValid: false,\n        invalidReason: ErrorReason.INVALID_AMOUNT,\n      };\n    }\n\n    if (!recipientValid) {\n      return {\n        isValid: false,\n        invalidReason: ErrorReason.INVALID_RECIPIENT,\n      };\n    }\n\n    // All validations passed\n    return {\n      isValid: true,\n      payer: authorization.address,\n      details: {\n        witnessValid,\n        authorizationValid,\n        amountValid,\n        deadlineValid: true,\n        recipientValid,\n      },\n    };\n    \n  } catch (error) {\n    console.error(\"Payment verification error:\", error);\n    return {\n      isValid: false,\n      invalidReason: ErrorReason.UNEXPECTED_ERROR,\n    };\n  }\n}\n\n/**\n * Validate signature format\n */\nfunction isValidSignature(signature: string): boolean {\n  return (\n    typeof signature === 'string' &&\n    signature.startsWith('0x') &&\n    signature.length === 132 // 65 bytes = 130 hex chars + 0x prefix\n  );\n}\n\n/**\n * Validate EIP-7702 authorization format\n */\nfunction isValidAuthorization(authorization: any): boolean {\n  const { chainId, address, nonce, yParity, r, s } = authorization;\n  \n  return !!(\n    typeof chainId === 'number' && chainId > 0 &&\n    typeof address === 'string' && address.startsWith('0x') && address.length === 42 &&\n    typeof nonce === 'number' && nonce >= 0 &&\n    typeof yParity === 'number' && (yParity === 0 || yParity === 1) &&\n    typeof r === 'string' && r.startsWith('0x') && r.length === 66 &&\n    typeof s === 'string' && s.startsWith('0x') && s.length === 66\n  );\n}\n\n/**\n * Validate payment amount\n */\nfunction isValidAmount(amount: string): boolean {\n  try {\n    const amountBigInt = BigInt(amount);\n    return amountBigInt > 0n;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Validate recipient address\n */\nfunction isValidRecipient(recipient: string): boolean {\n  return (\n    typeof recipient === 'string' &&\n    recipient.startsWith('0x') &&\n    recipient.length === 42\n  );\n}\n\n/**\n * Verify EIP-712 typed data signature\n */\nasync function verifyEIP712Signature(\n  signature: string,\n  witness: any,\n  expectedSigner: string\n): Promise<boolean> {\n  try {\n    const { verifyTypedData } = await import('viem');\n    \n    const { domain, types, message } = witness;\n    \n    // Verify the signature\n    const valid = await verifyTypedData({\n      address: expectedSigner as any,\n      domain: {\n        name: domain.name,\n        version: domain.version,\n        chainId: domain.chainId,\n        verifyingContract: domain.verifyingContract as any,\n      },\n      types: types,\n      primaryType: Object.keys(types).find(key => key !== 'EIP712Domain') || 'TransferAuthorization',\n      message: message,\n      signature: signature as any,\n    });\n\n    return valid;\n    \n  } catch (error) {\n    console.error(\"EIP-712 verification error:\", error);\n    return false;\n  }\n}\n\n/**\n * Verify EIP-7702 authorization signature\n * \n * The authorization allows a User's EOA to delegate its code to implementationContract.\n * The signature must be from the User's EOA (the owner), not the contract.\n */\nasync function verifyEIP7702Authorization(\n  authorization: any,\n  expectedContract: string,\n  expectedSigner: string\n): Promise<boolean> {\n  try {\n    const viem = await import('viem');\n    const { recoverAddress, keccak256, toRlp, toHex, concat, hexToBytes } = viem;\n    \n    const { chainId, address, nonce, yParity, r, s } = authorization;\n    \n    console.log(`üîç Verifying EIP-7702 Authorization:`);\n    console.log(`   Contract address: ${address}`);\n    console.log(`   Expected contract: ${expectedContract}`);\n    console.log(`   Expected signer (owner): ${expectedSigner}`);\n    console.log(`   Chain ID: ${chainId}`);\n    console.log(`   EOA Nonce: ${nonce}`);\n    \n    // 1. Verify the authorization is for the expected contract\n    if (address.toLowerCase() !== expectedContract.toLowerCase()) {\n      console.error(`‚ùå Authorization contract mismatch: ${address} !== ${expectedContract}`);\n      return false;\n    }\n    \n    // 2. Construct EIP-7702 authorization message\n    // Format: keccak256(MAGIC || rlp([chain_id, address, nonce]))\n    // This is signed by the User's EOA to authorize delegation\n    const MAGIC = '0x05';\n    \n    // Use toRlp instead of encodeRlp\n    const rlpData = toRlp([\n      toHex(chainId),\n      address.toLowerCase(),\n      toHex(nonce),\n    ]);\n    \n    // Concatenate MAGIC and RLP data\n    const authHash = keccak256(concat([MAGIC as any, rlpData]));\n    console.log(`   Authorization hash: ${authHash.slice(0, 20)}...`);\n    \n    // 3. Recover signer from signature\n    const recoveredAddress = await recoverAddress({\n      hash: authHash,\n      signature: { r: r as any, s: s as any, yParity },\n    });\n    \n    console.log(`   Recovered signer: ${recoveredAddress}`);\n    \n    // 4. Verify the recovered address matches the expected signer (owner)\n    if (recoveredAddress.toLowerCase() !== expectedSigner.toLowerCase()) {\n      console.error(`‚ùå Authorization signer mismatch:`);\n      console.error(`   Expected: ${expectedSigner}`);\n      console.error(`   Got: ${recoveredAddress}`);\n      return false;\n    }\n    \n    console.log(`‚úÖ Authorization signature is valid (signed by owner ${recoveredAddress})`);\n    return true;\n    \n  } catch (error) {\n    console.error(\"‚ùå EIP-7702 authorization verification error:\", error);\n    return false;\n  }\n}\n\n","import type { Request, Response } from \"express\";\nimport type { SignedPaymentPayload } from \"@x402-bnb/core\";\nimport { SignedPaymentPayloadSchema } from \"@x402-bnb/core\";\nimport { verifyPaymentWithChecks } from \"../../services/verification\";\nimport type { EnvConfig } from \"../../config/env\";\n\n/**\n * POST /verify\n * Verify a payment payload\n */\nexport async function handleVerify(\n  req: Request,\n  res: Response,\n  config: EnvConfig,\n): Promise<void> {\n  try {\n    // Validate request body\n\n    console.log(\"/verify go req body\", req.body);\n\n    const parseResult = SignedPaymentPayloadSchema.safeParse(req.body);\n\n\n    if (!parseResult.success) {\n      res.status(400).json({\n        error: \"Invalid payment payload\",\n        details: parseResult.error.errors,\n      });\n      return;\n    }\n\n    const payload: SignedPaymentPayload = parseResult.data as SignedPaymentPayload;\n\n    // Verify payment\n    const result = await verifyPaymentWithChecks(payload, config);\n\n    console.log(\"/verify go result\", result);\n\n    res.json(result);\n  } catch (error) {\n    console.error(\"Verification error:\", error);\n    res.status(500).json({\n      error: \"Internal server error\",\n      message: error instanceof Error ? error.message : \"Unknown error\",\n    });\n  }\n}\n\n","import type { SignedPaymentPayload, SettlementResult } from \"@x402-bnb/core\";\nimport type { WitnessTypedData } from \"@x402-bnb/core\";\nimport { PaymentScheme } from \"@x402-bnb/core\";\nimport { ethers } from \"ethers\";\n\n/**\n * Settle a payment using ethers.js (same as signature-based-transfer.js)\n * \n * This executes a real EIP-7702 transaction on-chain using the proven method.\n */\nexport async function settlePaymentWithMonitoring(\n  payload: SignedPaymentPayload,\n): Promise<SettlementResult> {\n  try {\n    const { witnessSignature, authorization, paymentDetails } = payload;\n    \n    // Only support single payment for now\n    if (paymentDetails.scheme !== PaymentScheme.EIP7702_DELEGATED) {\n      return {\n        success: false,\n        error: \"Only single payment scheme is supported\",\n      };\n    }\n\n    const witness = paymentDetails.witness as WitnessTypedData;\n\n    if (!witness?.message) {\n      return {\n        success: false,\n        error: \"Invalid witness data\",\n      };\n    }\n\n    const message = witness.message;\n\n    // Get recipient address - check both 'to' and 'recipient' fields, fallback to paymentDetails.to\n    // Handle different message structures (some may use 'recipient' instead of 'to')\n    const recipient = ('to' in message && message.to) \n      ? message.to \n      : ('recipient' in message && (message as { recipient?: string }).recipient)\n      ? (message as { recipient: string }).recipient\n      : paymentDetails.to;\n    \n    if (!recipient) {\n      return {\n        success: false,\n        error: \"Missing recipient address in witness message\",\n      };\n    }\n\n    // Get RPC URL from clients\n    const rpcUrl = process.env.RPC_URL_BSC_MAINNET || process.env.RPC_URL;\n    const sponsorPrivateKey = process.env.SPONSOR_PRIVATE_KEY || process.env.FACILITATOR_PRIVATE_KEY;\n\n    if (!rpcUrl || !sponsorPrivateKey) {\n      return {\n        success: false,\n        error: \"Missing RPC_URL or SPONSOR_PRIVATE_KEY configuration\",\n      };\n    }\n\n    // Create ethers.js provider and wallet (same as signature-based-transfer.js)\n    const provider = new ethers.JsonRpcProvider(rpcUrl);\n    const facilitatorWallet = new ethers.Wallet(sponsorPrivateKey, provider);\n\n    console.error(`   üíº Using facilitator: ${facilitatorWallet.address}`);\n\n    // 1. Encode executeTransfer function call (same ABI as successful script)\n    const SIGNATURE_EXECUTOR_ABI = [\n      \"function executeTransfer(address owner, address facilitator, address token, address recipient, uint256 amount, uint256 nonce, uint256 deadline, bytes calldata signature) external\",\n    ];\n\n    // Get amount, nonce, deadline - handle both bigint and string/string representation\n    const amount = typeof message.amount === 'bigint' ? message.amount.toString() : String(message.amount);\n    const nonce = typeof message.nonce === 'bigint' ? message.nonce.toString() : String(message.nonce);\n    const deadline = typeof message.deadline === 'bigint' ? message.deadline.toString() : String(message.deadline);\n\n    const executorInterface = new ethers.Interface(SIGNATURE_EXECUTOR_ABI);\n    const callData = executorInterface.encodeFunctionData(\"executeTransfer\", [\n      message.owner,        // owner\n      facilitatorWallet.address, // facilitator\n      message.token,        // token\n      recipient,            // recipient (supports both 'to' and 'recipient' fields)\n      amount,               // amount\n      nonce,                // nonce\n      deadline,             // deadline\n      witnessSignature      // signature\n    ]);\n\n    console.error(`üìã Transaction details:`);\n    console.error(`   owner: ${message.owner}`);\n    console.error(`   facilitator: ${facilitatorWallet.address}`);\n    console.error(`   token: ${message.token}`);\n    console.error(`   recipient: ${recipient}`);\n    console.error(`   amount: ${amount}`);\n    console.error(`   nonce: ${nonce}`);\n    console.error(`   deadline: ${deadline}`);\n\n    // 2. Get facilitator nonce\n    const facilitatorNonce = await facilitatorWallet.getNonce();\n    const feeData = await provider.getFeeData();\n\n    // 3. Prepare EIP-7702 authorization tuple (from payload)\n    // ethers.js requires signature to be an object with r, s, and yParity\n    const authorizationTuple = {\n      chainId: Number(authorization.chainId),\n      address: authorization.address,\n      nonce: Number(authorization.nonce),\n      signature: {\n        r: authorization.r,\n        s: authorization.s,\n        yParity: Number(authorization.yParity) as 0 | 1,\n      },\n    };\n\n    // 4. Construct EIP-7702 transaction (same structure as successful script)\n    const tx = {\n      type: 4,  // EIP-7702\n      to: message.owner, // Target is User EOA (will be delegated)\n      data: callData,\n      authorizationList: [authorizationTuple],\n      chainId: Number(authorization.chainId),\n      nonce: facilitatorNonce,\n      gasLimit: 300000n,\n      maxFeePerGas: feeData.maxFeePerGas || ethers.parseUnits(\"3\", \"gwei\"),\n      maxPriorityFeePerGas: feeData.maxPriorityFeePerGas || ethers.parseUnits(\"1.5\", \"gwei\"),\n    };\n\n    console.error(`üì§ Sending EIP-7702 transaction...`);\n    console.error(`   Type: 0x04 (EIP-7702)`);\n    console.error(`   From: ${facilitatorWallet.address} (Facilitator)`);\n    console.error(`   To: ${message.owner} (User EOA)`);\n\n    // 5. Send transaction\n    const txResponse = await facilitatorWallet.sendTransaction(tx);\n\n    // 6. Wait for confirmation\n    const receipt = await txResponse.wait();\n\n    // 7. Check transaction status\n    if (!receipt) {\n      return {\n        success: false,\n        error: \"Transaction receipt not available\",\n        txHash: txResponse.hash as `0x${string}`,\n      };\n    }\n\n    if (receipt.status === 1) {\n      return {\n        success: true,\n        txHash: txResponse.hash as `0x${string}`,\n        blockNumber: BigInt(receipt.blockNumber),\n      };\n    } else {\n      return {\n        success: false,\n        error: \"Transaction reverted on-chain\",\n        txHash: txResponse.hash as `0x${string}`,\n      };\n    }\n\n  } catch (error) {\n    console.error(\"‚ùå Settlement error:\", error);\n    const errorMessage = error instanceof Error ? error.message : String(error);\n\n    // Provide more detailed error information\n    if (errorMessage.includes('insufficient funds')) {\n      return {\n        success: false,\n        error: \"Insufficient gas funds in facilitator wallet\",\n      };\n    } else if (errorMessage.includes('nonce')) {\n      return {\n        success: false,\n        error: \"Invalid nonce - transaction may have already been executed\",\n      };\n    } else if (errorMessage.includes('execution reverted')) {\n      return {\n        success: false,\n        error: \"Contract execution reverted - check signature and authorization\",\n      };\n    }\n\n    return {\n      success: false,\n      error: errorMessage,\n    };\n  }\n}\n\n","import type { Request, Response } from \"express\";\nimport type { SignedPaymentPayload, SupportedNetwork } from \"@x402-bnb/core\";\nimport { SignedPaymentPayloadSchema } from \"@x402-bnb/core\";\nimport { settlePaymentWithMonitoring } from \"../../services/settlement\";\nimport { getNetworkClients, type NetworkClients } from \"../../config/networks\";\n\n/**\n * POST /settle\n * Settle a payment by submitting transaction\n */\nexport async function handleSettle(\n  req: Request,\n  res: Response,\n  clientsMap: Map<SupportedNetwork, NetworkClients>,\n): Promise<void> {\n  try {\n    // Validate request body\n    const parseResult = SignedPaymentPayloadSchema.safeParse(req.body);\n\n    if (!parseResult.success) {\n      res.status(400).json({\n        error: \"Invalid payment payload\",\n        details: parseResult.error.errors,\n      });\n      return;\n    }\n\n    // Convert parsed data to match SignedPaymentPayload type\n    const parsed = parseResult.data;\n    const payload: SignedPaymentPayload = {\n      witnessSignature: parsed.witnessSignature as `0x${string}`,\n      authorization: {\n        chainId: BigInt(parsed.authorization.chainId),\n        address: parsed.authorization.address as `0x${string}`,\n        nonce: BigInt(parsed.authorization.nonce),\n        yParity: parsed.authorization.yParity,\n        r: parsed.authorization.r as `0x${string}`,\n        s: parsed.authorization.s as `0x${string}`,\n      },\n      paymentDetails: parsed.paymentDetails as SignedPaymentPayload[\"paymentDetails\"],\n    };\n\n    // Get network clients\n    const clients = getNetworkClients(clientsMap, payload.paymentDetails.networkId);\n\n    if (!clients) {\n      res.status(400).json({\n        error: \"Unsupported network\",\n        network: payload.paymentDetails.networkId,\n      });\n      return;\n    }\n\n    // Settle payment\n    const result = await settlePaymentWithMonitoring(payload);\n\n    if (result.success) {\n      res.json({\n        success: true,\n        txHash: result.txHash,\n        blockNumber: result.blockNumber?.toString(),\n      });\n    } else {\n      res.status(500).json({\n        success: false,\n        error: result.error,\n      });\n    }\n  } catch (error) {\n    console.error(\"Settlement error:\", error);\n    res.status(500).json({\n      error: \"Internal server error\",\n      message: error instanceof Error ? error.message : \"Unknown error\",\n    });\n  }\n}\n\n","import type { Request, Response } from \"express\";\nimport type { SupportedNetwork } from \"@x402-bnb/core\";\nimport { NetworkConfigs } from \"@x402-bnb/core\";\nimport type { NetworkClients } from \"../../config/networks\";\n\n/**\n * GET /supported\n * Return supported networks and their configurations\n */\nexport async function handleSupported(\n  req: Request,\n  res: Response,\n  clientsMap: Map<SupportedNetwork, NetworkClients>,\n): Promise<void> {\n  try {\n    const supportedNetworks = Array.from(clientsMap.keys()).map((network) => {\n      const config = NetworkConfigs[network];\n      return {\n        networkId: network,\n        chainId: config.chainId,\n        name: config.name,\n        explorer: config.explorer,\n      };\n    });\n\n    res.json({\n      version: 1,\n      networks: supportedNetworks,\n    });\n  } catch (error) {\n    console.error(\"Supported networks error:\", error);\n    res.status(500).json({\n      error: \"Internal server error\",\n    });\n  }\n}\n\n","import express from \"express\";\nimport type { Express } from \"express\";\nimport type { SupportedNetwork } from \"@x402-bnb/core\";\nimport type { EnvConfig } from \"../config/env\";\nimport type { NetworkClients } from \"../config/networks\";\nimport { handleVerify } from \"./routes/verify\";\nimport { handleSettle } from \"./routes/settle\";\nimport { handleSupported } from \"./routes/supported\";\n\n/**\n * Create Express server with facilitator routes\n */\nexport function createServer(\n  config: EnvConfig,\n  clientsMap: Map<SupportedNetwork, NetworkClients>,\n): Express {\n  const app = express();\n\n  // Middleware\n  app.use(express.json());\n\n  // CORS headers\n  app.use((req, res, next) => {\n    res.header(\"Access-Control-Allow-Origin\", \"*\");\n    res.header(\"Access-Control-Allow-Methods\", \"GET, POST, OPTIONS\");\n    res.header(\"Access-Control-Allow-Headers\", \"Content-Type, Authorization\");\n\n    if (req.method === \"OPTIONS\") {\n      res.sendStatus(200);\n      return;\n    }\n\n    next();\n  });\n\n  // Routes\n  app.get(\"/\", (_req, res) => {\n    res.json({\n      name: \"x402 BNB Facilitator\",\n      version: \"0.1.0\",\n      endpoints: {\n        verify: \"POST /verify\",\n        settle: \"POST /settle\",\n        supported: \"GET /supported\",\n      },\n    });\n  });\n\n  app.post(\"/verify\", (req, res) => handleVerify(req, res, config));\n\n  app.post(\"/settle\", (req, res) => handleSettle(req, res, clientsMap));\n\n  app.get(\"/supported\", (req, res) => handleSupported(req, res, clientsMap));\n\n  // Health check\n  app.get(\"/health\", (_req, res) => {\n    // Get facilitator address from the wallet client\n    let facilitatorAddress: string | undefined;\n    try {\n      // Get the first network client to extract facilitator address\n      const firstClient = Array.from(clientsMap.values())[0];\n      facilitatorAddress = firstClient?.walletClient?.account?.address;\n    } catch (error) {\n      console.warn(\"Could not determine facilitator address:\", error);\n    }\n\n    res.json({\n      status: \"ok\",\n      facilitator: facilitatorAddress\n    });\n  });\n\n  // Error handler\n  app.use((err: Error, _req: express.Request, res: express.Response, _next: express.NextFunction) => {\n    console.error(\"Server error:\", err);\n    res.status(500).json({\n      error: \"Internal server error\",\n      message: err.message,\n    });\n  });\n\n  return app;\n}\n\n","/**\n * x402 BNB Facilitator Service\n * \n * A facilitator server for verifying and settling EIP-7702 delegated payments\n * on BSC and other EVM networks.\n */\n\nimport { loadEnvConfig } from \"./config/env\";\nimport { createNetworkClients } from \"./config/networks\";\nimport { createServer } from \"./api/server\";\n\nasync function main() {\n  console.log(\"Starting x402 BNB Facilitator...\");\n\n  // Load configuration\n  const config = loadEnvConfig();\n  console.log(`Host: ${config.host}`);\n  console.log(`Port: ${config.port}`);\n  console.log(`Log level: ${config.logLevel}`);\n\n  // Create network clients\n  const clientsMap = createNetworkClients(config);\n  console.log(`Configured ${clientsMap.size} network(s)`);\n\n  // Create and start server\n  const app = createServer(config, clientsMap);\n\n  app.listen(config.port, config.host, () => {\n    console.log(`Facilitator listening on http://${config.host}:${config.port}`);\n    console.log(`Ready to process payments!`);\n  });\n}\n\n// Run if executed directly\nif (require.main === module) {\n  main().catch((error) => {\n    console.error(\"Fatal error:\", error);\n    process.exit(1);\n  });\n}\n\nexport { loadEnvConfig, createNetworkClients, createServer };\n\n"]}